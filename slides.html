<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js ie6" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->  <html class="no-js" lang="en"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	
	<title>Test Doubles</title>

	<meta name="generator" content="Slide Show (S9)">
	<meta name="author" content="Jean-Michel Garnier">
	<meta name="viewport" content="width=1024, user-scalable=no">

	<!-- Core and extension CSS files -->
	<link rel="stylesheet" href="core/deck.core.css">
	<link rel="stylesheet" href="extensions/goto/deck.goto.css">
	<link rel="stylesheet" href="extensions/menu/deck.menu.css">
	<link rel="stylesheet" href="extensions/navigation/deck.navigation.css">
	<link rel="stylesheet" href="extensions/status/deck.status.css">
	<link rel="stylesheet" href="extensions/hash/deck.hash.css">
  <link rel="stylesheet" href="extensions/highlighter/shCore.css">
	<link rel="stylesheet" href="extensions/highlighter/shThemeEclipse.css">
	
	<!-- Theme CSS files (menu swaps these out) -->
	<link rel="stylesheet" id="style-theme-link" href="themes/style/mnml.css">
  <!-- <link rel="stylesheet" id="transition-theme-link" href="themes/transition/horizontal-slide.css"> -->

	<!-- Custom CSS just for this page -->
	<!-- GB: changed fixed name to variable -->
	<link rel="stylesheet"  href="slides.css">
	
	<script src="lib/modernizr.custom.js"></script>
</head>

<body class="deck-container">

<div class="theme-menu">
	<h2>Themes</h2>
	
	<label for="style-themes">Style:</label>
	<select id="style-themes">
		<option value="themes/style/web-2.0.css">Web 2.0</option>
		<option value="themes/style/swiss.css">Swiss</option>
		<option value="themes/style/neon.css">Neon</option>
		<option selected value="themes/style/mnml.css">mnml</option>
		<option value="">None</option>
	</select>
	
	<label for="transition-themes">Transition:</label>
	<select id="transition-themes">
		<option value="themes/transition/horizontal-slide.css">Horizontal Slide</option>
		<option value="themes/transition/vertical-slide.css">Vertical Slide</option>
		<option value="themes/transition/fade.css">Fade</option>
		<option selected value="">None</option>
	</select>
</div>

<section class="slide" id="title-slide">
	<h1>Test Doubles</h1>
</section>

<!-- note: assumes no header (breaking slides w/ SLIDE directive) -->

  <section class="slide" id="2">
    <!-- === begin markdown block =====================================================

      generated by markdown 1.0.0 on Ruby 1.9.3 (2013-02-22) [x86_64-darwin12.3.0]
                on 2013-08-14 12:08:04 +0200 with Markdown engine kramdown (0.14.0)
                  using options { !to be done! }
  -->

<!-- _S9SLIDE_  -->

<p><img src="images/xunit.png" alt="" /></p>

<p><a href="http://www.amazon.fr/xUnit-Test-Patterns-Refactoring-Code/dp/0131495054/ref=sr_1_1?ie=UTF8&amp;qid=1354305592&amp;sr=8-1">xUnit Test Patterns</a></p>



  </section>

  <section class="slide" id="3">
    <!-- _S9SLIDE_ -->
<h2 id="agenda">Agenda</h2>

<ul>
  <li>Why you should not stub or mock the Class under Test</li>
  <li>When to stub?</li>
  <li>When to mock?</li>
  <li>RSpec onfire</li>
</ul>


  </section>

  <section class="slide" id="4">
    <!-- _S9SLIDE_  -->

<h1 id="why-you-should-not-stub-or-mock-the-class-under-test">Why you should not stub or mock the Class under Test</h1>



  </section>

  <section class="slide" id="5">
    <!-- _S9SLIDE_ -->
<h2 id="everyone-does-it">Everyone does it!</h2>

<p><img src="images/google_stub_internals.png" alt="" /></p>

<p><a href="https://www.google.com/search?q=how+to+stub+%22class+under+test%22+methods&amp;oq=how+to+stub+%22class+under+test%22+methods">https://www.google.com/search?q=how+to+stub+%22class+under+test%22+methods&amp;oq=how+to+stub+%22class+under+test%22+methods</a></p>



  </section>

  <section class="slide" id="6">
    <!-- _S9SLIDE_ -->
<h2 id="example">Example</h2>

<!-- begin code{:name=>"../spec/examples/stub_internals_spec.rb"} -->
<div class="code"><pre class="brush: ruby toolbar: false gutter: true">class GitStatusDecorator
  def initialize(git_status)
    @git_status = git_status
  end

  def status
    &quot;#{dirty}&quot;
  end

  def dirty
    &quot;WTF!&quot;
  end
end

describe &quot;GitStatusDecorator #status&quot; do
  context &quot;when some files have been changed&quot; do
    before do
      @decorator = GitStatusDecorator.new(&quot;M spec/example_spec.rb&quot;)
    end

    it do
      @decorator.stub dirty: '*'
      @decorator.status.should end_with('*')
    end
  end
end
</pre></div>
<div class="codeurl">../spec/examples/stub_internals_spec.rb</div>
<!-- end code -->



  </section>

  <section class="slide" id="7">
    <!-- _S9SLIDE_ -->
<h2 id="always-green">Always green!</h2>

<p><img src="images/always_green.png" alt="" /></p>



  </section>

  <section class="slide" id="8">
    <!-- _S9SLIDE_ -->
<h2 id="oop">1. OOP</h2>

<blockquote>
  <p>Unit tests are consumers of your class interface. A well written unit
test should have <em>no awareness of the internal workings of your class</em></p>
</blockquote>



  </section>

  <section class="slide" id="9">
    <!-- _S9SLIDE_ -->
<h2 id="hard-to-read">Hard to read</h2>



  </section>

  <section class="slide" id="10">
    <!-- _S9SLIDE_ -->
<h2 id="fragile-test">Fragile test</h2>



  </section>

  <section class="slide" id="11">
    <!-- _S9SLIDE_ -->
<h2 id="when-should-i-stub">When should I stub?</h2>

<p>…</p>



  </section>

  <section class="slide" id="12">
    <!-- _S9SLIDE_ -->
<h2 id="when-should-i-mock">When should I mock?</h2>

<p>…</p>



  </section>

  <section class="slide" id="13">
    <!-- _S9SLIDE_ -->
<h2 id="discussion">Discussion</h2>

<!-- begin code{} -->
<div class="code"><pre class="brush: ruby toolbar: false gutter: true">
class StatusFinder
  def currently(status)
    # ... 
    query_builder.filter(relation, status)
  end

  private

  def query_builder
    @query_builder ||= SnStatusFinderQueryBuilder.new(ability)
  end
end

describe '#currently' do
  subject(:finder) { SnStatusFinder.accessible_by(@ability) }

  it 'should delegate to the query builder' do
    finder.send(:query_builder).should_receive(:filter)
    finder.currently(:pending)
  end
end
</pre></div>
<!-- end code -->



  </section>

  <section class="slide" id="14">
    <!-- _S9SLIDE_ -->
<h2 id="sandy-metzs-fantasy-world">Sandy Metz’s fantasy world</h2>

<todo link="" to="" poodr.info="">

## Rspec on fire

  &lt;https://github.com/xaviershay/rspec-fire&gt;

  ![](images/on_fire.jpg)

## Links

  * &lt;http://blakesmith.me/2012/02/29/test-stubbing-as-an-antipattern.html&gt;
  * [Ian Cooper presentation: TDD, where did it all go wrong](http://vimeo.com/68375232#t=3402)
  * &lt;http://devblog.avdi.org/2011/09/06/making-a-mockery-of-tdd&gt;
</todo>
<!-- === end markdown block ===================================================== -->

  </section>



<a href="#" class="deck-prev-link" title="Previous">&#8592;</a>
<a href="#" class="deck-next-link" title="Next">&#8594;</a>

<p class="deck-status">
	<span class="deck-status-current"></span>
	/
	<span class="deck-status-total"></span>
</p>

<form action="." method="get" class="goto-form">
	<label for="goto-slide">Go to slide:</label>
	<input type="number" name="slidenum" id="goto-slide">
	<input type="submit" value="Go">
</form>

<a href="." title="Permalink to this slide" class="deck-permalink">#</a>


  <!-- Grab Google CDN's jQuery, with a protocol relative URL; fall back to local if offline -->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="lib/jquery-1.6.4.min.js"><\/script>')</script>

<!-- Deck Core and extensions -->
<script src="core/deck.core.js"></script>
<script src="extensions/menu/deck.menu.js"></script>
<script src="extensions/goto/deck.goto.js"></script>
<script src="extensions/status/deck.status.js"></script>
<script src="extensions/navigation/deck.navigation.js"></script>
<script src="extensions/hash/deck.hash.js"></script>
<script src="extensions/highlighter/shCore.js"></script>
<script src="extensions/highlighter/shBrushRuby.js"></script>

<!-- Specific to this page -->
<!-- GB: adding introduction.js inline -->
<script>
$(function() {
	// Deck initialization
	$.deck('.slide');
  $('#transition-theme-link').attr('href', '');
  

	$('#style-themes').change(function() {
		$('#style-theme-link').attr('href', $(this).val());
	});
	
	$('#transition-themes').change(function() {
		$('#transition-theme-link').attr('href', $(this).val());
	});
});



<!-- Finally, to actually run the highlighter, you need to include this JS on your page -->
SyntaxHighlighter.all();
</script>

</body>
</html>
